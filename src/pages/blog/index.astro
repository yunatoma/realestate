---
import BaseLayout from '../../layouts/BaseLayout.astro';
import client from '../../lib/microcms/client';
import type { MicroCMSListResponse } from 'microcms-js-sdk';

const formatDate = (dateStr: string) => {
  const date = new Date(dateStr);
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return `${year}.${month}.${day}`;
};

export type Blog = {
  id: string;
  title: string;
  updatedAt: string;
};

// ブログカテゴリーで絞り込み、全件取得
const blogList = await client.get<MicroCMSListResponse<Blog>>({
  endpoint: 'news',
  queries: { filters: 'category[equals]yok1szxu1' },
});

const pageTitle = "ブログ一覧";
const pageDescription = "株式会社北村建設興業のブログ一覧です。";
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <div class="p-list">
    <h1 class="p-list__title">{pageTitle}</h1>
    <ul class="p-list__container">
      {blogList.contents.map((item) => (
        <li class="p-list__item">
          <a href={`/blog/${item.id}`} class="p-list__link">
            <span class="p-list__date">{formatDate(item.updatedAt)}</span>
            <span class="p-list__item-title">{item.title}</span>
          </a>
        </li>
      ))}
    </ul>
  </div>
</BaseLayout>